{% extends 'base.html' %}
{% load static %}

{% block title %}DevGuru - {{ question.title }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/question.css' %}">
{% endblock %}

{% block content %}
<div class="left-column">
    <div class="question-full">
        <div class="question-avatar">
        {% if question.author.avatar %}
            <img src="{{ question.author.avatar.url }}" alt="avatar">
        {% else %}
            <img src="{% static 'avatars/default-avatar.png' %}" alt="avatar">
        {% endif %}
        </div>
        <div class="question-full-content">
            <h2 class="question-full-title">{{ question.title }}</h2>
            <div class="question-full-body">
                <p>{{ question.detailed }}</p>
            </div>
            <div class="question-full-meta">
                <div class="question-full-tags">
                    {% for tag in question.tags.all %}
                    <a href="{% url 'tag' tag.name %}" class="tag">{{ tag.name }}</a>
                    {% endfor %}
                </div>
                <div class="question-full-stats">
                    <button
                        type="button"
                        class="like-btn {% if question.is_liked %}like-btn--active{% else %}like-btn--inactive{% endif %}"
                        data-question-id="{{ question.id }}"
                        data-liked="{{ question.is_liked|yesno:'true,false' }}"
                        onclick="toggleLike({{ question.id }})">
                        {% if question.is_liked %}üíñ{% else %}ü§ç{% endif %}
                    </button>
                    <span
                        class="question-full-likes"
                        id="question-{{ question.id }}-rating">
                        {{ question.rating }}
                    </span>
                </div>
            </div>
        </div>
    </div>

    <div class="answers-sort-tabs">
        <a href="?sort=best"
        class="answers-sort-tab {% if answers_sort == 'best' %}answers-sort-tab--active{% endif %}">
            –õ—É—á—à–∏–µ –æ—Ç–≤–µ—Ç—ã
        </a>
        <a href="?sort=new"
        class="answers-sort-tab {% if answers_sort == 'new' %}answers-sort-tab--active{% endif %}">
            –ü–æ—Å–ª–µ–¥–Ω–∏–µ
        </a>
    </div>

    <div class="answers-section">
        <h3 class="answers-section-title">–û—Ç–≤–µ—Ç—ã</h3>

        {% for answer in answers %}
        <div class="answer">
            <div class="answer-content">
                <div class="answer-avatar">
                    {% if answer.author.avatar %}
                        <img src="{{ answer.author.avatar.url }}" alt="–¢–µ–∫—É—â–∏–π –∞–≤–∞—Ç–∞—Ä" class="settings-current-avatar">
                    {% else %}
                        <img src="{% static '/avatars/default-avatar.png' %}" alt="–ù–µ—Ç –∞–≤–∞—Ç–∞—Ä–∞" class="settings-current-avatar">
                    {% endif %}
                </div>
                <div class="answer-main">
                    <div class="answer-text">
                        <p>{{ answer.answer_text }}</p>

                        {% if answer.is_correct %}
                            <span class="answer-correct-badge">
                                <span class="answer-correct-badge-icon">‚úì</span>
                                –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
                            </span>
                        {% endif %}
                    </div>          
                    <div class="answer-meta">                       
                        <div class="answer-like-wrapper">
                            <button
                                type="button"
                                class="like-btn like-answer-btn {% if answer.is_liked %}like-btn--active{% else %}like-btn--inactive{% endif %}"
                                data-answer-id="{{ answer.id }}"
                                data-liked="{{ answer.is_liked|yesno:'true,false' }}">
                                {% if answer.is_liked %}üíñ{% else %}ü§ç{% endif %}
                            </button>
                            <span
                                class="answer-likes"
                                id="answer-{{ answer.id }}-rating">
                                {{ answer.likes_count }}
                            </span>
                        </div>

                        {% if user.is_authenticated and user == question.author %}
                            <button
                                type="button"
                                class="answer-mark-correct-btn {% if answer.is_correct %}answer-mark-correct-btn--active{% endif %}"
                                data-answer-id="{{ answer.id }}">
                                {% if answer.is_correct %}
                                    ‚úì –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
                                {% else %}
                                    –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
                                {% endif %}
                            </button>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}

        {% include 'pagination.html' with page=answers %}
    </div>

    <div class="your-answer">
        <h3 class="your-answer-title">–í–∞—à –æ—Ç–≤–µ—Ç</h3>
        <form class="your-answer-form">
            <textarea class="form-textarea" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç –∑–¥–µ—Å—å..." rows="8"></textarea>
            <button type="submit" class="btn btn--submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç</button>
        </form>
    </div>
</div>

<div class="right-column">
    {% include 'sidebar.html' %}
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.like-answer-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const answerId = btn.dataset.answerId;
            toggleAnswerLike(answerId);
        });
    });
});
</script>

{% endblock %}